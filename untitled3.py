# -*- coding: utf-8 -*-
"""Untitled3.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1GNdi2ch5i_ij15pQWqhUMJnh6puoW1Ix
"""

# Commented out IPython magic to ensure Python compatibility.
import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
# %matplotlib inline
import matplotlib
import warnings
from sklearn.model_selection import train_test_split
warnings.filterwarnings('ignore')
matplotlib.rcParams["figure.figsize"] = (20,10)
from scipy.stats import ttest_ind

df = pd.read_csv('/content/Real estate.csv')
df.head()

df.shape

"""# Data Cleaning and Exploratoin"""

#Remove the id column
df.drop('No', inplace=True, axis=1)

# Rename the columns (remove X1..X2..X3.. and Y)
df.columns = ['transaction date', 'house age', 'distance to the nearest MRT station', 'number of convenience stores', 'latitude', 'longitude', 'house price of unit area']
df.head()

df.info()

df.describe()

fig, ax = plt.subplots(2, 3, figsize=(20, 9))
ax = ax.flatten()

sns.set()
sns.lineplot(data=df, x="transaction date", y="house price of unit area", ax=ax[0])
ax[0].set_title("Price of Unit Area vs. Transaction Date")

sns.lineplot(data=df, x="house age", y="house price of unit area", ax=ax[1])
ax[1].set_title("Price of Unit Area vs. House Age")

sns.lineplot(data=df, x="distance to the nearest MRT station", y="house price of unit area", ax=ax[2])
ax[2].set_title("Price of Unit Area vs. Distance to the nearest MRT station")

sns.lineplot(data=df, x="number of convenience stores", y="house price of unit area", ax=ax[3])
ax[3].set_title("Price of Unit Area vs. no. of Convenience Stores")

sns.lineplot(data=df, x="latitude", y="house price of unit area", ax=ax[4])
ax[4].set_title("Price of Unit Area vs. Latitude")

sns.lineplot(data=df, x="longitude", y="house price of unit area", ax=ax[5])
ax[5].set_title("Price of Unit Area vs. Longitude")

# set the spacing between subplots
plt.subplots_adjust(left=0.1,
                    bottom=0.1,
                    right=0.9,
                    top=0.9,
                    wspace=0.4,
                    hspace=0.4)
plt.show();

"""We can clearly see that the house price of unit area is proportional to the number of convenience stores.

Additionally, we can see that the closer the house is to the nearest MRT station, the heigher the price of unit are is.

The more the number of convenience stores near the house, the the higher the price of the unit area

Unexpectedly, the house age is not proportional to the price of unit area, but we can see a pattern and an obvious outlier.

A pattern can be noticed in longitude and latitude, but we need to explore them more.

let's take a look at the outliers

Distribution:
"""

# Histograms
fig = plt.figure(figsize=(16,16))
for index,col in enumerate(df):
    plt.subplot(6,3,index+1)
    sns.histplot(df.loc[:,col].dropna(), kde=True, stat="density", linewidth=0.5);
fig.tight_layout(pad=1.0);

fig = plt.figure(figsize=(14,15))
for index,col in enumerate(df):
    plt.subplot(6,3,index+1)
    sns.boxplot(y=col, data=df.dropna())
    plt.grid()
fig.tight_layout(pad=1.0)

df = df[df['house price of unit area']<80]
df = df[df['distance to the nearest MRT station']<3000]
df = df[df['longitude']>121.50]

# Check outliers
# Histograms
fig = plt.figure(figsize=(16,16))
for index,col in enumerate(df):
    plt.subplot(6,3,index+1)
    sns.histplot(df.loc[:,col].dropna(), kde=True, stat="density", linewidth=0.5);
fig.tight_layout(pad=1.0);

"""better than before

**Check the correlation**
"""

# Corr to price of unit area
numeric_train = df
correlation = numeric_train.corr()
correlation[['house price of unit area']].sort_values(['house price of unit area'], ascending=False)

"""The number of convenience stores is moderately correlated to the price of unit area, while the distance to the nearest MRT station negatively correlated"""

# correlation plot (heatmap)
corr = df.corr()
sns.heatmap(corr, cmap = 'YlGnBu', annot= True, linewidths=.5);

import scipy.stats as stats

#1
median_age = df['house age'].median()
above_median_age = df[df['house age'] > median_age]['house price of unit area']
below_median_age = df[df['house age'] <= median_age]['house price of unit area']
t_statistic, p_value = stats.ttest_ind(above_median_age, below_median_age)
alpha = 0.05
print(p_value)
if p_value < alpha:
    print("The average price per unit area of houses above the median age is significantly different from those below the median age.")
else:
    print("There is no significant difference in the average price per unit area of houses above the median age and those below the median age.")

#2
grouped_data = df.groupby('number of convenience stores')['house price of unit area']
f_statistic, p_value = stats.f_oneway(*[group for _, group in grouped_data])
alpha = 0.05
print(p_value)
if p_value < alpha:
    print("The average price per unit area significantly differs by the number of convenience stores (p-value = {:.4f}).".format(p_value))
else:
    print("There is no significant difference in the average price per unit area by the number of convenience stores (p-value = {:.4f}).".format(p_value))

#3
from scipy.stats import chi2_contingency

df['transaction date'] = pd.Categorical(df['transaction date'])
df['number_of_conv_stores'] = pd.Categorical(df['number of convenience stores'])
contingency_table = pd.crosstab(df['transaction date'], df['number of convenience stores'])
chi2, p_value, dof, expected = chi2_contingency(contingency_table)
alpha = 0.05
print("Chi-square statistic:", chi2)
print("P-value:", p_value)
if p_value < alpha:
    print("There is a significant association between 'transaction date' and 'number of convenience stores'.")
else:
    print("There is no significant association between 'transaction date' and 'number of convenience stores'.")

correlation = df.corr()['house price of unit area']
print("Correlation with the target variable house price of unit area:")
print(correlation)

X= df.drop('house price of unit area', axis=1)
y= df['house price of unit area']

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=101)

from sklearn.linear_model import LinearRegression
model= LinearRegression()
model.fit(X_train, y_train)
pd.DataFrame(model.coef_, X.columns, columns=['coeficient'])

y_pred= model.predict(X_test)
pd.DataFrame({'Y_test':y_test, 'Y_pred':y_pred}).head()

from sklearn import metrics
MAE= metrics.mean_absolute_error(y_test, y_pred)
MSE= metrics.mean_squared_error(y_test, y_pred)
RMSE= np.sqrt(MSE)
MAE
MSE
r2 = metrics.r2_score(y_test, y_pred)
print("Mean Squared Error (MSE): {:.4f}".format(MSE))
print("R-squared: {:.4f}".format(r2))

sns.scatterplot(x=y_test, y=y_pred, color='#20d489')
plt.axhline(y=30, color='#105c3c', ls='--')